# Проектная работа спринта 3

## Задание 1. Анализ и проектирование

### Подзадание 1.1. Описание текущей системы

#### Анализ предметной области
Доменная модель: [domain-model-strategic.puml](./docs/diagrams/domain/domain-model-strategic.puml)
> Данная модель отражает область автоматизации текущей системой Smart Home. Модель целевой экосистемы присутствует в разделе 1.2.

#### Требования
- Пользователи могут удалённо включать/выключать отопление в своих домах.
- Пользователи могут устанавливать необходимую температуру отопления.
- Система автоматически поддерживает заданную температуру, регулируя подачу тепла.
- Пользователи могут просматривать текущую температуру в своих домах через веб-интерфейс.

#### Архитектура
Диаграмма С4 System Context: [c4-context.puml](./docs/diagrams/C4/c4-context.puml)

Система представляет собой монолитное приложение на языке Java. Взаимодействие с сиcтемой осуществляется посредством обращений к REST API. Для хранения данных используется СУБД PostgreSQL.

Ограничения текущей архитектуры:

- Все компоненты системы (обработка запросов, бизнес-логика, работа с данными) находятся в рамках одного приложения.
- Все вызовы к API являются синхронными (блокирующими).
- Масштабирование ограничено, т.к. нет возможности масштабировать определенную функциональность приложения отдельно.
- Для обновления требуется остановка всего приложения, что влечет простой в работе.

### Подзадание 1.2. Архитектура микросервисов. Новая экосистема.

#### Требования
- Система позволяет управлять отоплением, включать и выключать свет, запирать и отпирать автоматические ворота, удаленно наблюдать за домом и будущее неуточненное поведение.
- Система поддерживает подключение к экосистеме устройств партнеров по стандартным протоколам.
- Пользователь может просматривать телеметрию.
- Пользователь может настраивать сценарии работы. Пользователь может программировать систему для управления различными модулями в соответствии со своими потребностями.

#### Архитектура

Диаграммы:
- [С4 Container](./docs/diagrams/C4/c4-container.puml)
- [С4 Component](./docs/diagrams/C4/c4-component.puml)

Особенности:
1. Предполагается развертывание системы в облаке для минимизации расходов. 
2. Взаимодействие между сервисами происходит синхронно. Это сделано для того, чтобы команда модулю не была отправлена в неподходящий момент, например: пользователь хочет открыть ворота, но сервис по коммуникации с управляющими модулями был недоступен. Пользователь открыл и закрыл ворота в ручном режиме, а через некоторое время, когда работоспособность микросервиса была восстановлена, система отправила команду на открытие ворот, хотя этого уже не требовалось.
3. Дома относятся к микросервису управления устройствами, т.к. группируют устройства.
4. Коммуникация с управляющими модулями выполняется через WebSocket. Инициатором установки соединения является управляющий модуль.

### Подзадание 1.3. ER-диаграмма

[ERD](./docs/diagrams/erd.puml)

### Подзадание 1.4. Создание и документирование API

- [REST API](./api.yaml) - описаны интерфейсы микросервисов управления устройствами, телеметрии, управления отоплением (за отопление отвечает ACL).
- [Async API](./async-api.yaml) - описаны интерфейсы асинхронного взаимодействия через WebSocket с микросервисами коммуникации с управляющими модулями и телеметрии.